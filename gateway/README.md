## Installing gateway software
### User PC
---
1. Prepare and install software on the Raspberry Pi.
- Please download raspbian image by the following link https://www.raspberrypi.org/downloads/raspbian/
- How to install downloaded image please follow the instruction https://www.raspberrypi.org/documentation/installation/installing-images/

2. Connect your Raspberry Pi to network.

3. Find your Raspberry Piâ€™s IP address.
Please, follow the instruction:
https://www.raspberrypi.org/documentation/remote-access/ip-address.md
As a result, you will get **\<raspberry_ip_address\>**.

4. Download script which installs IQoT software on the Raspberry Pi.
For this reason download iqot_gw.sh and whitelist.txt on your PC or clone this repo.
Replace XX:XX:XX:XX:XX:XX with your device ID in whitelist.txt file.
Your device ID will be displayed during endpoint firmware flashing and it is based on the device MAC address.
Put downloaded files to the Raspberry Pi using the commands described below.
##### Linux
```
scp iqot_gw.sh <raspberry_user>@<raspberry_ip_address>:/home/<raspberry_user>
scp whitelist.txt <raspberry_user>@<raspberry_ip_address>:/home/<raspberry_user>
```
##### Windows
```
Please, install the pscp.exe file on your 32- or 64-bit system. Follow the link below.
https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html
How to use pscp:
https://www.ssh.com/ssh/putty/putty-manuals/0.68/Chapter5.html

Copy files to Raspberry Pi:
pscp.exe iqot_gw.sh <raspberry_user>@<raspberry_ip_address>:/home/<raspberry_user>
pscp.exe whitelist.txt <raspberry_user>@<raspberry_ip_address>:/home/<raspberry_user>
```
>>>
Note:
**\<raspberry_user\>** default is 'pi'
>>>

5. SSH to the gateway device.
##### Linux
```
ssh <raspberry_user>@<raspberry_ip_address>
```
##### Windows
```
Please, install the putty.exe file on your 32- or 64-bit system. Follow the link below.
https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html
How to use SSH on Windows:
https://www.ssh.com/ssh/putty/windows/

SSH to the device:
- Run putty.exe
- Click on 'Session' category
- Enter <raspberry_ip_address> in 'Host Name' field
- Enter port 22 in 'Port' field
- Click 'Open' button
- In the opened window enter <raspberry_user> and password
```
### Raspberry Pi
---
6. Enable non-root user to run docker and supervisor commands. Then log out and log in from your host or reboot your device.
```
sudo groupadd docker
sudo usermod -aG docker $USER

sudo groupadd supervisor
sudo usermod -aG supervisor $USER
```

7. In the opened SSH console run installation script. Script will check for installed docker daemon and it will install a docker if it has not been installed yet. It will download two docker images.
The first one is the gateway core image. The second is the BLE sample image. The installed applications will run automatically after the device reboot. To run the script execute the following command:
```
sudo chmod +x $HOME/iqot_gw.sh
sudo $HOME/iqot_gw.sh install $HOME/whitelist.txt
```
Please note that during the installation process the Gateway ID is displayed. This is the unique ID, which must be used for the gateway provisioning in the IQoT application.
To control the installed gateway applications you can use the following commands:
```
sudo $HOME/iqot_gw.sh start (start all applications)
sudo $HOME/iqot_gw.sh stop (stop all applications)
sudo $HOME/iqot_gw.sh remove (remove installed applications)
$HOME/iqot_gw.sh id (show gateway ID)
```

### IQoT
---
8. Create a device in the IQoT application. For this purpose, please login to https://iqot.io with your credentials.
  * Switch to the Devices page.
  * Click the button '+ Add a device'.
  * Fill in the following fields:

    ```
    Name - Enter a unique name
    Device ID - Use the Gateway ID generated by the iqot_gw.sh script during the gateway software installation process
    Type - Please select Gateway type
    ```
